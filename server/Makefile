GOCMD=go
GOBUILD=$(GOCMD) build
GOCLEAN=$(GOCMD) clean
GOTEST=$(GOCMD) test
GOGET=$(GOCMD) get

BINARY_NAME=kyc

# This version-strategy uses git tags to set the version string
VERSION := $(shell git describe --tags --always --dirty)
#
# This version-strategy uses a manual value to set the version string
#VERSION := 1.2.3

all: test build
build:
	$(GOBUILD) -o $(BINARY_NAME) -v cmd/main.go
test:
	$(GOTEST) -v ./tests/...
	rm -f ./tests/test.db
clean:
	$(GOCLEAN)
	rm -f $(BINARY_NAME)
run:
	$(GOBUILD) -o $(BINARY_NAME) -v cmd/main.go
	./$(BINARY_NAME)
deps:
	$(GOGET) github.com/kataras/iris/...
	$(GOGET) github.com/iris-contrib/httpexpect/...
	$(GOGET) github.com/iris-contrib/middleware/cors...
	$(GOGET) github.com/kataras/iris/middleware/recover/...
	$(GOGET) gopkg.in/yaml.v2/...
	$(GOGET) github.com/dchest/captcha/...
	$(GOGET) github.com/go-ozzo/ozzo-validation/...
	$(GOGET) github.com/go-ozzo/ozzo-validation/is/...
	$(GOGET) github.com/go-xorm/xorm
	$(GOGET) github.com/go-xorm/core/...
	$(GOGET) github.com/lib/pq/...
	$(GOGET) github.com/mattn/go-sqlite3/...
	$(GOGET) github.com/aws/aws-sdk-go/aws/...
	$(GOGET) github.com/aws/aws-sdk-go/aws/session/...
	$(GOGET) github.com/aws/aws-sdk-go/service/ses/...

version:
	@echo $(VERSION)